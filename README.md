# PowerShell File Watcher Script

This PowerShell script monitors a folder and its subfolders for changes in files and logs the changes to a specified log file. It uses the .NET `FileSystemWatcher` class to detect the events and the `Register-ObjectEvent` cmdlet to subscribe to events generated by the `FileSystemWatcher` object.

## Variables and Functions

### `$filewatcher`

This variable is used to create a new instance of the `FileSystemWatcher` class. It specifies the path of the folder to be monitored, the file filter to apply (`*.*` in this case, meaning all files), and whether to include subdirectories (`$true` to include subdirectories).

```powershell
$filewatcher = New-Object System.IO.FileSystemWatcher
$filewatcher.Path = "D:\ltts\upload"
$filewatcher.Filter = "*.*"
$filewatcher.IncludeSubdirectories = $true
$filewatcher.EnableRaisingEvents = $true
```

### `Format-FileSize`

This function takes a file size in bytes as an input and returns the size in a human-readable format (e.g. "1.23 MB").

```powershell
Function Format-FileSize() {
Param ([int]$size)
If ($size -gt 1TB) {[string]::Format("{0:0.00} TB", $size / 1TB)}
ElseIf ($size -gt 1GB) {[string]::Format("{0:0.00} GB", $size / 1GB)}
ElseIf ($size -gt 1MB) {[string]::Format("{0:0.00} MB", $size / 1MB)}
ElseIf ($size -gt 1KB) {[string]::Format("{0:0.00} kB", $size / 1KB)}
ElseIf ($size -gt 0) {[string]::Format("{0:0.00} B", $size)}
Else {""}
}
```

## Event Actions

### `$writeaction`

This variable defines the action to be taken when a file change event is detected. It extracts the path of the file, the type of change (created, changed, deleted, or renamed), the username of the user who made the change, and the size of the file in a human-readable format. It then writes this information to a log file specified in the script.

```powershell
$writeaction = { $path = $Event.SourceEventArgs.FullPath
                $changeType = $Event.SourceEventArgs.ChangeType
                $userInfo=((Get-WMIObject -class Win32_ComputerSystem | Select-Object -ExpandProperty username) -split ‘\\’ )
                $userInfo[0] +”\”+$userInfo[1]
                $size = (Get-Item $path).length
                $size = Format-FileSize($size)
                $logline = "$(Get-Date), $changeType, $path, $userInfo , $size"
                Add-content "D:\ltts\log" -value $logline
              }
```

## Event Subscription

The following commands subscribe to the events generated by the `FileSystemWatcher` object and specify the action to be taken for each event. The events are `Created`, `Changed`, `Deleted`, and `Renamed`.

```powershell
Register-ObjectEvent $filewatcher "Created" -Action $writeaction
Register-ObjectEvent $filewatcher "Changed" -Action $writeaction
Register-ObjectEvent $filewatcher "Deleted" -Action $writeaction
Register-ObjectEvent $filewatcher "Renamed" -Action $writeaction
   while ($true) {sleep 5}
```


In this code block, we use the `Register-ObjectEvent` cmdlet to subscribe to the four events we're interested in (`Created`, `Changed`, `Deleted`, and `Renamed`). When an event is raised, the `$writeaction` script block is executed, which logs information about the event to a log file.

Finally, we enter an infinite loop using the `while ($true)` construct and call the `sleep` cmdlet with a duration of 5 seconds to prevent the script from exiting prematurely. This allows the script to continue monitoring the specified folder for changes until it is manually terminated.

Overall, this script is a useful tool for monitoring a specific folder and logging any changes made to its contents, making it ideal for a variety of use cases, such as tracking changes to important files or monitoring a shared network folder.
